<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <title>JazzyPop - Mobile Test</title>
    
    <!-- Main CSS -->
    <link rel="stylesheet" href="src/styles/main.css">
    
    <style>
        /* Mobile test specific */
        html {
            background: var(--bg-app, #0f1b20);
        }
        
        html, body {
            padding: 0;
            margin: 0;
            width: 100%;
            height: 100%;
            overflow-x: hidden;
            position: fixed;
            /* Prevent browser chrome from hiding/showing */
            overscroll-behavior: none;
            -webkit-overflow-scrolling: touch;
            background: var(--bg-app, #0f1b20);
        }
        
        .mobile-container {
            width: 100%;
            height: 100%;
            padding: 12px;
            padding-top: 80px; /* Space for larger stats bar */
            padding-bottom: env(safe-area-inset-bottom, 80px); /* Space for action bar */
            box-sizing: border-box;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
        }
        
        .debug-info {
            position: fixed;
            top: 10px;
            left: 10px;
            background: rgba(0,0,0,0.3);
            color: rgba(255,255,255,0.5);
            padding: 4px 8px;
            font-size: 10px;
            font-family: monospace;
            z-index: 100;
            border-radius: 4px;
        }
        
        .mode-toggle {
            position: fixed;
            top: 70px;
            right: 10px;
            z-index: var(--z-sticky);
            width: 58px;
            height: 58px;
            border-radius: 50%;
            background: var(--bg-card);
            border: 2px solid var(--border-default);
            box-shadow: var(--shadow-lg);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: transform 0.2s;
            padding: 5px;
            overflow: visible;
        }
        
        .mode-toggle img {
            width: 88px !important;
            height: 88px !important;
            max-width: none !important;
            max-height: none !important;
            object-fit: contain !important;
        }
        
        .mode-toggle:active {
            transform: scale(0.95);
        }
        
        .mode-toggle.active {
            background: var(--color-primary);
            border-color: var(--color-primary);
        }
        
        .mode-switcher {
            position: fixed;
            top: 134px;
            right: 10px;
            z-index: var(--z-sticky);
            background: var(--bg-card);
            padding: 8px;
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-lg);
            border: 2px solid var(--border-default);
            transform-origin: top right;
            transition: all 0.3s ease;
        }
        
        .mode-switcher.hidden {
            opacity: 0;
            transform: scale(0.8);
            pointer-events: none;
        }
        
        .mode-switcher .mode-btn {
            display: flex;
            width: 100%;
            text-align: left;
            margin-bottom: 4px;
        }
        
        .mode-switcher .mode-btn:last-child {
            margin-bottom: 0;
        }
        
        /* Fullscreen toggle button */
        .fullscreen-btn {
            position: fixed;
            bottom: env(safe-area-inset-bottom, 20px);
            left: 20px;
            z-index: var(--z-sticky);
            width: 44px;
            height: 44px;
            background: var(--bg-card);
            border: 2px solid var(--border-default);
            border-radius: 50%;
            color: var(--text-primary);
            font-size: 20px;
            cursor: pointer;
            box-shadow: var(--shadow-lg);
            display: flex;
            align-items: center;
            justify-content: center;
            transition: transform 0.2s;
        }
        
        .fullscreen-btn:active {
            transform: scale(0.95);
        }
        
        /* Submit button inside card */
        .submit-btn {
            padding: 12px 20px;
            background: var(--color-primary);
            border: none;
            border-radius: var(--radius-full);
            color: white;
            font-weight: bold;
            font-size: 14px;
            box-shadow: var(--shadow-md);
            cursor: pointer;
            transition: all 0.2s;
            float: right;
            min-width: 100px;
        }
        
        .submit-btn:active {
            transform: scale(0.95);
        }
        
        /* Stats bar */
        .stats-bar {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: var(--bg-card);
            border-bottom: 1px solid var(--border-default);
            padding: 12px 16px;
            padding-top: max(12px, env(safe-area-inset-top));
            z-index: var(--z-fixed);
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 18px;
            font-weight: var(--font-semibold);
        }
        
        .stat-item {
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .stat-item span:first-child {
            font-size: 22px;
        }
        
        .mode-btn {
            padding: 10px 14px;
            border: 2px solid var(--border-default);
            border-radius: var(--radius-md);
            background: var(--bg-elevated);
            color: var(--text-primary);
            cursor: pointer;
            transition: all var(--duration-fast) var(--easing-default);
            font-weight: var(--font-semibold);
            font-size: 18px;
            white-space: nowrap;
            display: flex;
            align-items: center;
        }
        
        .mode-btn.active {
            background: var(--color-primary);
            border-color: var(--color-primary);
            color: var(--text-on-primary);
        }
        
        .card {
            background: var(--bg-card);
            padding: 16px;
            border-radius: var(--radius-lg);
            margin-bottom: 12px;
            width: 100%;
            box-sizing: border-box;
        }
        
        .answer-option {
            background: var(--bg-elevated);
            padding: 14px 16px;
            margin-bottom: 8px;
            border-radius: var(--radius-md);
            border: 2px solid transparent;
            cursor: pointer;
            width: 100%;
            box-sizing: border-box;
            font-size: 16px; /* Prevent zoom on iOS */
        }
        
        .btn {
            padding: var(--space-md) var(--space-lg);
            border-radius: var(--radius-md);
            border: 2px solid var(--color-primary);
            background: var(--color-primary);
            color: var(--text-on-primary);
            cursor: pointer;
            font-weight: var(--font-semibold);
            width: 100%;
            margin-bottom: var(--space-sm);
        }
        
        /* Prevent horizontal scroll */
        * {
            max-width: 100vw;
            box-sizing: border-box;
        }
        
        /* Feedback bot overlay */
        .feedback-bot {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 200px;
            height: 200px;
            z-index: 9999;
            pointer-events: none;
        }
        
        @keyframes bot-jiggle-in {
            0% {
                transform: translate(-50%, -50%) scale(0);
                opacity: 0;
            }
            50% {
                transform: translate(-50%, -50%) scale(1.1);
            }
            60% {
                transform: translate(-50%, -50%) scale(1.1) rotate(-5deg);
            }
            70% {
                transform: translate(-50%, -50%) scale(1.1) rotate(5deg);
            }
            80% {
                transform: translate(-50%, -50%) scale(1.1) rotate(-3deg);
            }
            90% {
                transform: translate(-50%, -50%) scale(1.1) rotate(3deg);
            }
            100% {
                transform: translate(-50%, -50%) scale(1) rotate(0deg);
                opacity: 1;
            }
        }
        
        @keyframes bot-success-pulse {
            0% {
                transform: translate(-50%, -50%) scale(0);
                opacity: 0;
            }
            40% {
                transform: translate(-50%, -50%) scale(1.4);
                opacity: 1;
            }
            50% {
                transform: translate(-50%, -50%) scale(1.3);
            }
            60% {
                transform: translate(-50%, -50%) scale(1.4);
            }
            70% {
                transform: translate(-50%, -50%) scale(1.35);
            }
            100% {
                transform: translate(-50%, -50%) scale(1.2);
                opacity: 1;
            }
        }
        
        @keyframes bot-jiggle-out {
            0% {
                transform: translate(-50%, -50%) scale(1);
                opacity: 1;
            }
            50% {
                transform: translate(-50%, -50%) scale(1.05) rotate(-5deg);
            }
            100% {
                transform: translate(-50%, -50%) scale(0);
                opacity: 0;
            }
        }
        
        .feedback-bot.show {
            animation: bot-jiggle-in 0.7s ease-out forwards;
        }
        
        .feedback-bot.show.success {
            animation: bot-success-pulse 0.8s cubic-bezier(0.68, -0.55, 0.265, 1.55) forwards;
        }
        
        .feedback-bot.hide {
            animation: bot-jiggle-out 0.3s ease-in forwards;
        }
        
        /* Correct answer pulse */
        @keyframes correct-answer-pulse {
            0%, 100% {
                transform: scale(1);
                box-shadow: 0 0 0 0 rgba(46, 204, 64, 0.7);
            }
            50% {
                transform: scale(1.05);
                box-shadow: 0 0 20px 10px rgba(46, 204, 64, 0);
            }
        }
        
        .answer-option.correct-pulse {
            animation: correct-answer-pulse 1s ease-in-out infinite;
        }
        
        /* Zen mode ripple effect */
        @keyframes ripple-expand {
            0% {
                transform: translate(-50%, -50%) scale(0);
                opacity: 1;
                border-width: 3px;
                filter: blur(0px);
            }
            50% {
                border-width: 2px;
                filter: blur(0.5px);
            }
            100% {
                transform: translate(-50%, -50%) scale(4);
                opacity: 0;
                border-width: 1px;
                filter: blur(2px);
            }
        }
        
        /* Zen aquatic background */
        [data-mode="zen"] {
            background-image: url('src/images/zen-use-this-background.jpg');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            position: relative;
        }
        
        /* Animated water shimmer */
        [data-mode="zen"]::before {
            content: '';
            position: fixed;
            inset: 0;
            background: linear-gradient(45deg, 
                transparent 30%, 
                rgba(255, 255, 255, 0.1) 50%, 
                transparent 70%);
            background-size: 200% 200%;
            animation: water-shimmer 8s ease-in-out infinite;
            pointer-events: none;
            z-index: 0;
        }
        
        @keyframes water-shimmer {
            0% {
                background-position: 0% 0%;
                opacity: 0.3;
            }
            50% {
                background-position: 100% 100%;
                opacity: 0.5;
            }
            100% {
                background-position: 0% 0%;
                opacity: 0.3;
            }
        }
        
        /* Subtle vignette for depth */
        [data-mode="zen"] .mobile-container::before {
            content: '';
            position: fixed;
            inset: 0;
            background: radial-gradient(circle at center, 
                transparent 30%, 
                rgba(0, 20, 40, 0.2) 100%);
            pointer-events: none;
            z-index: 0;
        }
        
        /* Koi fish */
        .koi-fish {
            position: absolute;
            font-size: 40px;
            opacity: 0.7;
            filter: drop-shadow(0 4px 6px rgba(0,0,0,0.3));
        }
        
        /* Speed mode rotating background */
        [data-mode="speed"] .speed-bg-rotate {
            position: fixed;
            inset: -50%;
            width: 200%;
            height: 200%;
            background: repeating-linear-gradient(
                90deg,
                transparent,
                transparent 10px,
                rgba(0, 255, 136, 0.05) 10px,
                rgba(0, 255, 136, 0.05) 20px
            );
            animation: 
                rotate-bg 10s linear infinite,
                speed-pulse 1.5s ease-in-out infinite;
            pointer-events: none;
            z-index: 0;
        }
        
        @keyframes rotate-bg {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        
        @keyframes speed-pulse {
            0%, 100% { 
                opacity: 0.4;
                filter: brightness(1) blur(0px);
            }
            25% {
                opacity: 0.6;
                filter: brightness(1.2) blur(0.5px);
            }
            50% { 
                opacity: 0.8;
                filter: brightness(1.4) blur(0px);
            }
            75% {
                opacity: 0.5;
                filter: brightness(1.1) blur(0.5px);
            }
        }
        
        @keyframes speed-strobe {
            0% { filter: hue-rotate(0deg); }
            50% { filter: hue-rotate(10deg); }
            100% { filter: hue-rotate(-10deg); }
        }
        
        /* Speed timer */
        .speed-timer {
            position: fixed;
            top: 140px;
            right: 20px;
            font-size: 48px;
            font-weight: bold;
            color: #00ff88;
            text-shadow: 
                0 0 20px #00ff88,
                0 0 40px #00ff88;
            font-family: monospace;
            z-index: 100;
            animation: timer-pulse 1s ease-in-out infinite;
        }
        
        .speed-timer.warning {
            color: #ffaa00;
            text-shadow: 
                0 0 20px #ffaa00,
                0 0 40px #ffaa00;
            animation: timer-pulse 0.5s ease-in-out infinite;
        }
        
        .speed-timer.critical {
            color: #ff0044;
            text-shadow: 
                0 0 20px #ff0044,
                0 0 40px #ff0044;
            animation: timer-flash 0.3s ease-in-out infinite;
        }
        
        @keyframes timer-pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
        
        @keyframes timer-flash {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.5; transform: scale(1.2); }
        }
        
        /* Timer clone that grows huge */
        .timer-clone {
            position: fixed;
            top: 140px;
            right: 20px;
            font-size: 48px;
            font-weight: bold;
            color: #00ff88;
            text-shadow: 
                0 0 20px #00ff88,
                0 0 40px #00ff88;
            font-family: monospace;
            z-index: 99;
            animation: timer-explode 1s ease-out forwards;
            pointer-events: none;
        }
        
        .timer-clone.warning {
            color: #ffaa00;
            text-shadow: 
                0 0 20px #ffaa00,
                0 0 40px #ffaa00;
        }
        
        .timer-clone.critical {
            color: #ff0044;
            text-shadow: 
                0 0 20px #ff0044,
                0 0 40px #ff0044;
        }
        
        @keyframes timer-explode {
            0% {
                transform: scale(1) translateZ(0);
                opacity: 1;
            }
            50% {
                transform: scale(8) translateZ(200px);
                opacity: 0.8;
            }
            100% {
                transform: scale(20) translateZ(500px);
                opacity: 0;
            }
        }
        
        /* Time out effect */
        @keyframes timeout-flash {
            0% {
                background: var(--bg-elevated);
                transform: scale(1) rotate(0deg);
            }
            10% {
                background: #ff0044;
                transform: scale(1.1) rotate(-2deg);
                box-shadow: 0 0 30px #ff0044;
            }
            20% {
                background: #660022;
                transform: scale(0.95) rotate(2deg);
            }
            30% {
                background: #ff0044;
                transform: scale(1.05) rotate(-1deg);
                box-shadow: 0 0 40px #ff0044;
            }
            40% {
                background: #330011;
                transform: scale(1) rotate(0deg);
                opacity: 0.9;
            }
            /* Linger in the red state */
            50%, 80% {
                background: #220011;
                opacity: 0.8;
                transform: scale(1);
                box-shadow: 0 0 20px #ff0044;
            }
            /* Slow fade out */
            100% {
                background: #110008;
                opacity: 0.3;
                transform: scale(0.98);
                box-shadow: 0 0 10px #ff0044;
            }
        }
        
        .answer-option.timeout {
            animation: timeout-flash 3s ease-out forwards !important;
            border-color: #ff0044 !important;
        }
        
        @keyframes screen-shake {
            0%, 100% { transform: translateX(0); }
            10% { transform: translateX(-10px) rotate(-1deg); }
            20% { transform: translateX(10px) rotate(1deg); }
            30% { transform: translateX(-8px) rotate(-1deg); }
            40% { transform: translateX(8px) rotate(0deg); }
            50% { transform: translateX(-6px); }
            60% { transform: translateX(6px); }
            70% { transform: translateX(-4px); }
            80% { transform: translateX(4px); }
            90% { transform: translateX(-2px); }
        }
        
        @keyframes timeout-message {
            0% {
                transform: translate(-50%, -50%) scale(0) rotate(-180deg);
                opacity: 0;
            }
            50% {
                transform: translate(-50%, -50%) scale(1.2) rotate(5deg);
                opacity: 1;
            }
            100% {
                transform: translate(-50%, -50%) scale(1) rotate(0deg);
                opacity: 0;
            }
        }
        
        @keyframes swim-right {
            0% {
                transform: translateX(-100px) translateY(0) scaleX(1);
            }
            25% {
                transform: translateX(25vw) translateY(-20px) scaleX(1);
            }
            50% {
                transform: translateX(50vw) translateY(10px) scaleX(1);
            }
            75% {
                transform: translateX(75vw) translateY(-15px) scaleX(1);
            }
            100% {
                transform: translateX(calc(100vw + 100px)) translateY(0) scaleX(1);
            }
        }
        
        @keyframes swim-left {
            0% {
                transform: translateX(calc(100vw + 100px)) translateY(0) scaleX(-1);
            }
            25% {
                transform: translateX(75vw) translateY(20px) scaleX(-1);
            }
            50% {
                transform: translateX(50vw) translateY(-10px) scaleX(-1);
            }
            75% {
                transform: translateX(25vw) translateY(15px) scaleX(-1);
            }
            100% {
                transform: translateX(-100px) translateY(0) scaleX(-1);
            }
        }
    </style>
</head>
<body data-mode="normal">
    <!-- Stats Bar -->
    <div class="stats-bar">
        <div class="stat-item">
            <span>❤️</span>
            <span>5</span>
        </div>
        <div class="stat-item">
            <span>🔥</span>
            <span>7</span>
        </div>
        <div class="stat-item">
            <span>⚡</span>
            <span>x2</span>
        </div>
        <div class="stat-item">
            <span>💎</span>
            <span>1,250</span>
        </div>
    </div>
    
    <!-- Mode Toggle Button -->
    <button class="mode-toggle" onclick="toggleModeMenu()" id="modeToggle">
        <img src="src/images/p0qp0q-clean.svg" alt="p0qp0q" style="width: 110px; height: 110px;">
    </button>
    
    <!-- Mode Switcher Menu -->
    <div class="mode-switcher hidden" id="modeSwitcher">
        <button class="mode-btn active" onclick="setMode('normal')"><img src="src/images/p0qp0q-clean.svg" style="width: 36px; height: 36px; vertical-align: middle; margin-right: 8px;"> p0qp0q</button>
        <button class="mode-btn" onclick="setMode('chaos')"><img src="src/images/chaos-bot.svg" style="width: 36px; height: 36px; vertical-align: middle; margin-right: 8px;"> Chaos</button>
        <button class="mode-btn" onclick="setMode('zen')"><img src="src/images/zen-bot.svg" style="width: 36px; height: 36px; vertical-align: middle; margin-right: 8px;"> Zen</button>
        <button class="mode-btn" onclick="setMode('speed')"><img src="src/images/speed-bot.svg" style="width: 36px; height: 36px; vertical-align: middle; margin-right: 8px;"> Speed</button>
    </div>
    
    <!-- Fullscreen Button (keep floating) -->
    <button class="fullscreen-btn" onclick="toggleFullscreen()" title="Toggle Fullscreen">⛶</button>
    
    <!-- Mobile Container -->
    <div class="mobile-container">
        <h1>JazzyPop Mobile</h1>
        <p class="text-secondary">Testing mobile layout and interactions</p>
        
        <!-- Quiz Card -->
        <div class="card" style="margin-top: 80px;" id="quizCard">
            <h3 id="questionText" style="margin-bottom: 20px;">Loading question...</h3>
            <div id="answersContainer" style="margin-bottom: 16px;">
                <!-- Answers will be loaded here -->
            </div>
            <div style="clear: both;"></div>
            <button class="submit-btn" onclick="submitAnswer()" id="submitBtn">Skip</button>
            <div style="clear: both;"></div>
        </div>
        
        <!-- Stats moved to top bar -->
    </div>
    
    <!-- Debug Info -->
    <div class="debug-info">
        <div>Width: <span id="width">0</span>px</div>
        <div>Height: <span id="height">0</span>px</div>
        <div>DPR: <span id="dpr">1</span></div>
    </div>
    
    <!-- Zen mode containers -->
    <div id="zen-background" style="position: fixed; inset: 0; pointer-events: none; z-index: 0; display: none;"></div>
    <div id="ripple-container" style="position: fixed; inset: 0; pointer-events: none; z-index: 1;"></div>
    
    <!-- Speed mode rotating background -->
    <div class="speed-bg-rotate" style="display: none;" id="speed-bg"></div>
    
    <!-- Speed mode timer -->
    <div class="speed-timer" style="display: none;" id="speed-timer">30</div>
    
    <script type="module">
        import { sampleQuestions, getRandomQuestion } from './src/data/sampleQuestions.js';
        
        let currentQuestion = null;
        let score = 0;
        let questionsAnswered = 0;
        // Mode menu toggle
        let modeMenuOpen = false;
        // Speed mode timer
        let speedTimer = null;
        let timeRemaining = 30;
        function toggleModeMenu() {
            modeMenuOpen = !modeMenuOpen;
            const switcher = document.getElementById('modeSwitcher');
            const toggle = document.getElementById('modeToggle');
            
            if (modeMenuOpen) {
                switcher.classList.remove('hidden');
                toggle.classList.add('active');
            } else {
                switcher.classList.add('hidden');
                toggle.classList.remove('active');
            }
        }
        
        // Close menu when clicking outside
        document.addEventListener('click', (e) => {
            if (modeMenuOpen && !e.target.closest('.mode-toggle') && !e.target.closest('.mode-switcher')) {
                toggleModeMenu();
            }
        });
        
        // Mode switching
        function setMode(mode) {
            document.body.setAttribute('data-mode', mode);
            
            // Update active button
            document.querySelectorAll('.mode-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.textContent.toLowerCase().includes(mode)) {
                    btn.classList.add('active');
                }
            });
            
            // Update toggle icon based on mode
            const toggle = document.getElementById('modeToggle');
            
            // Bot images for each mode
            const botImages = {
                normal: 'p0qp0q-clean.svg',
                chaos: 'chaos-bot.svg',
                zen: 'zen-bot.svg',
                speed: 'speed-bot.svg'
            };
            
            // Emoji fallbacks
            const emojiFallbacks = {
                normal: '🤖',
                chaos: '🌪️',
                zen: '🧘',
                speed: '⚡'
            };
            
            // Check if bot image exists
            const botImage = botImages[mode];
            if (botImage) {
                // Use bot image
                toggle.innerHTML = `<img src="src/images/${botImage}" alt="${mode} bot" style="width: 110px; height: 110px;" onerror="this.style.display='none'; this.parentElement.innerHTML='${emojiFallbacks[mode]}'">`;
                toggle.style.fontSize = '20px';
            } else {
                // Use emoji fallback
                toggle.innerHTML = emojiFallbacks[mode] || '🎮';
                toggle.style.fontSize = '24px';
            }
            
            // Close menu
            toggleModeMenu();
            
            // Handle Zen mode effects
            if (mode === 'zen') {
                enableZenMode();
            } else {
                disableZenMode();
            }
            
            // Handle Speed mode background and timer
            const speedBg = document.getElementById('speed-bg');
            const speedTimerEl = document.getElementById('speed-timer');
            if (mode === 'speed') {
                speedBg.style.display = 'block';
                speedTimerEl.style.display = 'block';
                startSpeedTimer();
            } else {
                speedBg.style.display = 'none';
                speedTimerEl.style.display = 'none';
                stopSpeedTimer();
            }
        }
        
        // Load new question
        function loadQuestion() {
            currentQuestion = getRandomQuestion();
            
            // Update question text
            document.getElementById('questionText').textContent = currentQuestion.question;
            
            // Clear and populate answers
            const container = document.getElementById('answersContainer');
            container.innerHTML = '';
            
            // Shuffle answers
            const shuffledAnswers = [...currentQuestion.answers].sort(() => Math.random() - 0.5);
            
            shuffledAnswers.forEach(answer => {
                const option = document.createElement('div');
                option.className = 'answer-option';
                option.textContent = answer.text;
                option.dataset.answerId = answer.id;
                option.dataset.correct = answer.correct;
                
                option.addEventListener('click', selectAnswer);
                container.appendChild(option);
            });
        }
        
        // Answer selection
        function selectAnswer(e) {
            // Remove previous selection
            document.querySelectorAll('.answer-option').forEach(opt => {
                opt.classList.remove('selected');
                opt.style.background = 'var(--bg-elevated)';
                opt.style.borderColor = 'transparent';
                opt.style.color = '';
            });
            
            // Select this answer
            e.target.classList.add('selected');
            e.target.style.background = 'var(--color-primary)';
            e.target.style.borderColor = 'var(--color-primary)';
            e.target.style.color = 'white';
            
            // Update button text
            document.getElementById('submitBtn').textContent = 'Submit';
        }
        
        // Debug info
        function updateDebugInfo() {
            document.getElementById('width').textContent = window.innerWidth;
            document.getElementById('height').textContent = window.innerHeight;
            document.getElementById('dpr').textContent = window.devicePixelRatio;
        }
        
        updateDebugInfo();
        window.addEventListener('resize', updateDebugInfo);
        
        // Update stats display
        function updateStats() {
            // Update streak (score)
            document.querySelector('.stat-item:nth-child(2) span:last-child').textContent = score;
        }
        
        // Initialize first question
        loadQuestion();
        
        // Submit answer
        window.submitAnswer = function() {
            const btn = document.getElementById('submitBtn');
            const selected = document.querySelector('.answer-option.selected');
            
            if (!selected) {
                // Skip animation
                btn.textContent = '⏩';
                questionsAnswered++;
                setTimeout(loadQuestion, 500);
            } else {
                // Check if correct
                const isCorrect = selected.dataset.correct === 'true';
                
                // Update score
                if (isCorrect) {
                    score++;
                    btn.textContent = '✓';
                } else {
                    btn.textContent = '❌';
                }
                
                // Show feedback bot
                showFeedbackBot(isCorrect);
                
                // Disable further selection and show feedback
                document.querySelectorAll('.answer-option').forEach(opt => {
                    opt.style.pointerEvents = 'none';
                    if (opt.dataset.correct === 'true') {
                        opt.style.background = 'var(--color-success)';
                        opt.style.borderColor = 'var(--color-success)';
                        opt.style.color = 'white';
                        // Add pulsing animation to correct answer
                        opt.classList.add('correct-pulse');
                    } else if (opt.classList.contains('selected')) {
                        // Highlight wrong answer in red
                        opt.style.background = 'var(--color-error)';
                        opt.style.borderColor = 'var(--color-error)';
                        opt.style.color = 'white';
                        opt.style.opacity = '0.8';
                    }
                });
                
                questionsAnswered++;
                updateStats();
                
                // Load next question after delay
                const delay = document.body.getAttribute('data-mode') === 'speed' ? 5000 : 2000;
                setTimeout(() => {
                    btn.textContent = 'Skip';
                    loadQuestion();
                    // Restart timer if in speed mode
                    if (document.body.getAttribute('data-mode') === 'speed') {
                        startSpeedTimer();
                    }
                }, delay);
            }
        }
        
        // Make functions global for onclick handlers
        window.setMode = setMode;
        window.toggleModeMenu = toggleModeMenu;
        
        // Fullscreen toggle
        window.toggleFullscreen = function() {
            if (!document.fullscreenElement) {
                document.documentElement.requestFullscreen().catch(err => {
                    console.log('Fullscreen error:', err);
                });
            } else {
                document.exitFullscreen();
            }
        }
        
        // Add to home screen prompt
        if ('standalone' in window.navigator && !window.navigator.standalone) {
            const hint = document.createElement('div');
            hint.style.cssText = 'position: fixed; bottom: 80px; left: 50%; transform: translateX(-50%); background: rgba(0,0,0,0.8); color: white; padding: 10px 20px; border-radius: 20px; font-size: 14px; z-index: 9999;';
            hint.textContent = 'Add to Home Screen for best experience';
            document.body.appendChild(hint);
            setTimeout(() => hint.remove(), 5000);
        }
        
        // Create success particles
        function createSuccessParticles(element) {
            const rect = element.getBoundingClientRect();
            const particles = ['✨', '⭐', '🎆', '✨', '👏'];
            
            particles.forEach((emoji, i) => {
                setTimeout(() => {
                    const particle = document.createElement('div');
                    particle.className = 'success-particle';
                    particle.textContent = emoji;
                    particle.style.left = rect.left + rect.width / 2 + 'px';
                    particle.style.top = rect.top + rect.height / 2 + 'px';
                    particle.style.fontSize = '24px';
                    document.body.appendChild(particle);
                    
                    setTimeout(() => particle.remove(), 600);
                }, i * 100);
            });
        }
        
        // Show feedback bot
        window.showFeedbackBot = function(isCorrect) {
            // Remove any existing feedback bot
            const existingBot = document.querySelector('.feedback-bot');
            if (existingBot) existingBot.remove();
            
            // Create new feedback bot
            const bot = document.createElement('div');
            bot.className = isCorrect ? 'feedback-bot show success' : 'feedback-bot show';
            
            const img = document.createElement('img');
            img.style.width = '100%';
            img.style.height = '100%';
            
            if (isCorrect) {
                // Use checkmark bot for correct answers
                img.src = 'src/images/checkmark-bot.svg';
                // Also create success particles
                setTimeout(() => {
                    const rect = bot.getBoundingClientRect();
                    createSuccessParticles({ getBoundingClientRect: () => rect });
                }, 300);
            } else {
                // Use not bot for incorrect answers
                img.src = 'src/images/not-bot.svg';
            }
            
            bot.appendChild(img);
            document.body.appendChild(bot);
            
            // Remove bot after animation
            setTimeout(() => {
                bot.classList.remove('show');
                bot.classList.add('hide');
                setTimeout(() => bot.remove(), 300);
            }, 1500);
        }
        
        // Zen mode ripple effects
        let rippleInterval;
        
        function enableZenRipples() {
            // Create ripple on click
            document.addEventListener('click', createRipple);
            
            // Create automatic ripples
            rippleInterval = setInterval(() => {
                if (document.body.getAttribute('data-mode') === 'zen') {
                    createRipple({
                        clientX: Math.random() * window.innerWidth,
                        clientY: Math.random() * window.innerHeight,
                        auto: true
                    });
                }
            }, 3000);
        }
        
        function disableZenRipples() {
            document.removeEventListener('click', createRipple);
            clearInterval(rippleInterval);
            document.getElementById('ripple-container').innerHTML = '';
        }
        
        function createRipple(e) {
            if (document.body.getAttribute('data-mode') !== 'zen') return;
            
            const container = document.getElementById('ripple-container');
            const x = e.clientX;
            const y = e.clientY;
            
            // Create multiple ripples for water effect
            for (let i = 0; i < 3; i++) {
                setTimeout(() => {
                    const ripple = document.createElement('div');
                    const size = e.auto ? 150 : 200;
                    
                    ripple.style.cssText = `
                        position: absolute;
                        left: ${x}px;
                        top: ${y}px;
                        width: ${size}px;
                        height: ${size}px;
                        border-radius: 50%;
                        border: 2px solid rgba(255, 255, 255, ${e.auto ? '0.4' : '0.6'});
                        background: transparent;
                        transform: translate(-50%, -50%) scale(0);
                        animation: ripple-expand ${e.auto ? '4s' : '3s'} ease-out forwards;
                    `;
                    
                    container.appendChild(ripple);
                    setTimeout(() => ripple.remove(), 4000);
                }, i * 200);
            }
        }
        
        // Check initial mode
        if (document.body.getAttribute('data-mode') === 'zen') {
            enableZenMode();
        }
        
        // Zen mode functions
        function enableZenMode() {
            enableZenRipples();
        }
        
        function disableZenMode() {
            disableZenRipples();
        }
        
        // Speed timer functions
        function startSpeedTimer() {
            stopSpeedTimer(); // Clear any existing timer
            timeRemaining = 30;
            
            // Set initial display without animation
            const timerEl = document.getElementById('speed-timer');
            timerEl.textContent = timeRemaining;
            timerEl.className = 'speed-timer';
            
            speedTimer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    // Time's up! Auto-submit or skip
                    stopSpeedTimer();
                    timeOutEffect();
                    // Don't submit immediately - let the effect play out
                }
            }, 1000);
        }
        
        function stopSpeedTimer() {
            if (speedTimer) {
                clearInterval(speedTimer);
                speedTimer = null;
            }
        }
        
        function updateTimerDisplay() {
            const timerEl = document.getElementById('speed-timer');
            
            // Create exploding clone of the old number
            if (document.body.getAttribute('data-mode') === 'speed' && timerEl.textContent !== '' && timerEl.textContent !== timeRemaining.toString()) {
                const clone = document.createElement('div');
                clone.className = 'timer-clone';
                clone.textContent = timerEl.textContent;
                
                // Match the color state based on the OLD number
                const oldTime = parseInt(timerEl.textContent);
                if (oldTime <= 6) {
                    clone.classList.add('critical');
                } else if (oldTime <= 11) {
                    clone.classList.add('warning');
                }
                
                document.body.appendChild(clone);
                
                // Remove clone after animation
                setTimeout(() => clone.remove(), 1000);
            }
            
            // Update the actual timer
            timerEl.textContent = timeRemaining;
            
            // Update timer color based on time remaining
            timerEl.className = 'speed-timer';
            if (timeRemaining <= 5) {
                timerEl.classList.add('critical');
            } else if (timeRemaining <= 10) {
                timerEl.classList.add('warning');
            }
        }
        
        // Time out bang effect
        function timeOutEffect() {
            // Make all answer options flash angry red
            const answers = document.querySelectorAll('.answer-option');
            answers.forEach((answer, index) => {
                setTimeout(() => {
                    answer.classList.add('timeout');
                }, index * 100); // Stagger the effect
            });
            
            // Disable clicking on answers
            answers.forEach(answer => {
                answer.style.pointerEvents = 'none';
            });
            
            // Screen shake effect
            const container = document.querySelector('.mobile-container');
            container.style.animation = 'screen-shake 0.5s ease-out';
            
            // Big "TIME'S UP!" message
            const timeoutMsg = document.createElement('div');
            timeoutMsg.style.cssText = `
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                font-size: 72px;
                font-weight: bold;
                color: #ff0044;
                text-shadow: 0 0 40px #ff0044;
                z-index: 9999;
                animation: timeout-message 1s ease-out forwards;
                font-family: monospace;
                text-transform: uppercase;
            `;
            timeoutMsg.textContent = "TIME'S UP!";
            document.body.appendChild(timeoutMsg);
            
            setTimeout(() => timeoutMsg.remove(), 1000);
            
            // Wait for the full animation before loading next question
            setTimeout(() => {
                document.getElementById('submitBtn').textContent = 'Skip';
                loadQuestion();
                if (document.body.getAttribute('data-mode') === 'speed') {
                    startSpeedTimer();
                }
            }, 4000); // Give full time for the 3s animation plus buffer
        }
    </script>
</body>
</html>