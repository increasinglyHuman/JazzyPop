<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Economy Cards - Custom Icons</title>
    
    <!-- CSS -->
    <link rel="stylesheet" href="./kawaii-quiz-app/src/styles/components/dashboard.css">
    <link rel="stylesheet" href="./kawaii-quiz-app/src/styles/components/card.css">
    <link rel="stylesheet" href="./kawaii-quiz-app/src/styles/components/card-economics-new.css">
    
    <style>
        body {
            background: #131f24;
            padding: 20px;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
        }
        
        /* Removed debug styles */
        
        .test-container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .cards-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        h1 {
            color: #f8f9fa;
            text-align: center;
            margin-bottom: 40px;
        }
        
        .test-controls {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 30px;
        }
        
        .test-controls button {
            background: var(--primary);
            color: var(--bg-dark);
            border: none;
            padding: 10px 20px;
            border-radius: 20px;
            font-weight: 600;
            cursor: pointer;
            margin-right: 10px;
            margin-bottom: 10px;
        }
        
        .test-controls button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }
        
        .resource-display {
            background: rgba(0, 0, 0, 0.3);
            padding: 15px;
            border-radius: 8px;
            color: #f8f9fa;
            margin-bottom: 20px;
            display: flex;
            gap: 20px;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .resource-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 600;
        }
        
        .resource-item img {
            width: 24px;
            height: 24px;
        }
        
        .icon-showcase {
            background: rgba(255, 255, 255, 0.05);
            padding: 30px;
            border-radius: 12px;
            margin-bottom: 30px;
        }
        
        .icon-showcase h2 {
            color: #f8f9fa;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .icon-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 20px;
        }
        
        .icon-item {
            text-align: center;
            padding: 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
        }
        
        .icon-item img {
            width: 48px;
            height: 48px;
            margin-bottom: 10px;
            filter: brightness(1.2);
        }
        
        .icon-item label {
            color: #f8f9fa;
            font-size: 12px;
            display: block;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>Economy Cards with Custom Icons</h1>
        
        <!-- Icon Showcase -->
        <div class="icon-showcase">
            <h2>Custom 48x48 Economy Icons</h2>
            <div class="icon-grid">
                <div class="icon-item">
                    <img src="./48x48-EconomyIcons/energyIcon.svg" alt="Energy">
                    <label>Energy</label>
                </div>
                <div class="icon-item">
                    <img src="./48x48-EconomyIcons/gemIcon.svg" alt="Gems">
                    <label>Gems</label>
                </div>
                <div class="icon-item">
                    <img src="./48x48-EconomyIcons/heartIcon.svg" alt="Hearts">
                    <label>Hearts</label>
                </div>
                <div class="icon-item">
                    <img src="./48x48-EconomyIcons/coinIcon.svg" alt="Coins">
                    <label>Coins</label>
                </div>
                <div class="icon-item">
                    <img src="./48x48-EconomyIcons/xpIcon.svg" alt="XP">
                    <label>Experience</label>
                </div>
                <div class="icon-item">
                    <img src="./48x48-EconomyIcons/ticketIcon.svg" alt="Tickets">
                    <label>Tickets</label>
                </div>
                <div class="icon-item">
                    <img src="./48x48-EconomyIcons/keyIcon.svg" alt="Keys">
                    <label>Keys</label>
                </div>
                <div class="icon-item">
                    <img src="./48x48-EconomyIcons/giftBox.svg" alt="Mystery">
                    <label>Mystery Box</label>
                </div>
            </div>
        </div>
        
        <div class="resource-display">
            <div class="resource-item">
                <img src="./48x48-EconomyIcons/energyIcon.svg" alt="Energy">
                <span>Energy:</span>
                <span id="energyAmount">100</span>
            </div>
            <div class="resource-item">
                <img src="./48x48-EconomyIcons/gemIcon.svg" alt="Gems">
                <span>Gems:</span>
                <span id="gemsAmount">5</span>
            </div>
            <div class="resource-item">
                <img src="./48x48-EconomyIcons/heartIcon.svg" alt="Hearts">
                <span>Hearts:</span>
                <span id="heartsAmount">5</span>
            </div>
            <div class="resource-item">
                <img src="./48x48-EconomyIcons/coinIcon.svg" alt="Coins">
                <span>Coins:</span>
                <span id="coinsAmount">50</span>
            </div>
            <div class="resource-item">
                <img src="./48x48-EconomyIcons/ticketIcon.svg" alt="Tickets">
                <span>Tickets:</span>
                <span id="ticketsAmount">3</span>
            </div>
            <div class="resource-item">
                <img src="./48x48-EconomyIcons/keyIcon.svg" alt="Keys">
                <span>Keys:</span>
                <span id="keysAmount">2</span>
            </div>
        </div>
        
        <div class="test-controls">
            <button onclick="adjustResources('energy', -50)">Use 50 Energy</button>
            <button onclick="adjustResources('energy', 20)">Add 20 Energy</button>
            <button onclick="adjustResources('gems', -3)">Use 3 Gems</button>
            <button onclick="adjustResources('hearts', -2)">Lose 2 Hearts</button>
            <button onclick="adjustResources('coins', 10)">Add 10 Coins</button>
            <button onclick="toggleEvent('power-hour')">Toggle Power Hour</button>
            <button onclick="toggleEvent('weekend')">Toggle Weekend Boost</button>
            <button onclick="refreshCards()">Refresh Cards</button>
        </div>
        
        <div class="cards-grid" id="cardsContainer"></div>
    </div>
    
    <!-- Mock Economy Manager -->
    <script>
        window.economyManager = {
            displayCache: {
                energy: 100,
                gems: 5,
                hearts: 5,
                coins: 50,
                tickets: 3,
                keys: 2
            },
            getResources() {
                return this.displayCache;
            },
            canAfford(cost) {
                const resources = this.getResources();
                if (cost.energy && resources.energy < cost.energy) return false;
                if (cost.gems && resources.gems < cost.gems) return false;
                if (cost.minHearts && resources.hearts < cost.minHearts) return false;
                if (cost.coins && resources.coins < cost.coins) return false;
                if (cost.tickets && resources.tickets < cost.tickets) return false;
                if (cost.keys && resources.keys < cost.keys) return false;
                return true;
            }
        };
        
        // Test controls
        function adjustResources(type, amount) {
            window.economyManager.displayCache[type] += amount;
            window.economyManager.displayCache[type] = Math.max(0, window.economyManager.displayCache[type]);
            updateResourceDisplay();
            refreshCards();
        }
        
        function updateResourceDisplay() {
            document.getElementById('energyAmount').textContent = window.economyManager.displayCache.energy;
            document.getElementById('gemsAmount').textContent = window.economyManager.displayCache.gems;
            document.getElementById('heartsAmount').textContent = window.economyManager.displayCache.hearts;
            document.getElementById('coinsAmount').textContent = window.economyManager.displayCache.coins;
            document.getElementById('ticketsAmount').textContent = window.economyManager.displayCache.tickets;
            document.getElementById('keysAmount').textContent = window.economyManager.displayCache.keys;
        }
        
        let activeEvents = [];
        
        function toggleEvent(eventType) {
            const eventIndex = activeEvents.findIndex(e => e.type === eventType);
            if (eventIndex >= 0) {
                activeEvents.splice(eventIndex, 1);
            } else {
                if (eventType === 'power-hour') {
                    activeEvents.push({
                        type: 'power-hour',
                        label: 'POWER HOUR',
                        name: 'Power Hour',
                        costModifier: { type: 'percentage', value: 0.5 }
                    });
                } else if (eventType === 'weekend') {
                    activeEvents.push({
                        type: 'learning-party',
                        label: 'WEEKEND BOOST',
                        name: 'Weekend Learning Party'
                    });
                }
            }
            refreshCards();
        }
    </script>
    
    <!-- Create Enhanced Card Component with Custom Icons -->
    <script>
        // Copy of GenericCardEnhanced but with custom icon paths
        class GenericCardEnhancedCustom {
            constructor(config) {
                this.id = config.id;
                this.type = config.type || 'default';
                this.theme = config.theme || 'standard';
                this.layout = config.layout || 'vertical';
                this.priority = config.priority;
                this.data = config.data || {};
                this.economics = config.economics || null;
                this.events = config.events || [];
                this.component = config.component;
                this.componentConfig = config.componentConfig || {};
                this.element = null;
                this.onAction = config.onAction || (() => {});
                
                this.economyManager = window.economyManager || null;
            }

            render() {
                this.element = document.createElement('div');
                const classes = ['generic-card', 'card'];
                if (this.theme) classes.push(`theme-${this.theme}`);
                if (this.layout) classes.push(`layout-${this.layout}`);
                if (this.priority) classes.push(`priority-${this.priority}`);
                
                if (!this.checkAffordability()) {
                    classes.push('economy-locked');
                }
                
                this.element.className = classes.join(' ');
                this.element.setAttribute('data-card-id', this.id);
                
                this.element.innerHTML = this.buildEnhancedCard();
                this.attachEventHandlers();
                
                return this.element;
            }

            buildEnhancedCard() {
                const sections = [];
                
                sections.push('<div class="card-flex-container">');
                
                if (this.economics?.cost) {
                    sections.push(this.buildCostBar());
                }
                
                sections.push('<div class="card-content-area">');
                
                if (this.events.length > 0) {
                    sections.push(this.buildEventBadges());
                }
                
                if (this.data.header) {
                    sections.push(this.buildSection('header', this.data.header));
                }
                
                if (this.data.media) {
                    sections.push(this.buildSection('media', this.data.media));
                }
                
                if (this.data.body) {
                    sections.push(this.buildSection('body', this.data.body));
                }
                
                if (this.data.stats) {
                    sections.push(this.buildSection('stats', this.data.stats));
                }
                
                sections.push('</div>');
                
                if (this.economics?.rewards) {
                    sections.push(this.buildRewardsFooter());
                }
                
                if (this.data.actions) {
                    sections.push(this.buildEnhancedActions(this.data.actions));
                }
                
                sections.push('</div>');
                
                return sections.join('');
            }
            
            buildCostBar() {
                const cost = this.economics.cost;
                const playerResources = this.getPlayerResources();
                const eventModifiers = this.getEventModifiers();
                
                const costItems = [];
                
                // Energy cost with custom icon
                if (cost.energy > 0) {
                    const modifiedCost = this.applyEventModifiers(cost.energy, eventModifiers);
                    const hasEnough = playerResources.energy >= modifiedCost;
                    
                    if (modifiedCost !== cost.energy) {
                        costItems.push(`
                            <span class="cost-item energy">
                                <img src="./48x48-EconomyIcons/energyIcon.svg" class="icon-small" alt="Energy">
                                <span class="cost-original">${cost.energy}</span>
                                → <span class="cost-discounted">${modifiedCost}</span>
                            </span>
                        `);
                    } else if (modifiedCost === 0) {
                        costItems.push(`<span class="cost-item cost-free">FREE PLAY</span>`);
                    } else {
                        costItems.push(`
                            <span class="cost-item energy ${!hasEnough ? 'insufficient' : ''}">
                                <img src="./48x48-EconomyIcons/energyIcon.svg" class="icon-small" alt="Energy">
                                ${cost.energy}
                            </span>
                        `);
                    }
                }
                
                // Gem cost with custom icon
                if (cost.gems > 0) {
                    const hasEnough = playerResources.gems >= cost.gems;
                    costItems.push(`
                        <span class="cost-item gems ${!hasEnough ? 'insufficient' : ''}">
                            <img src="./48x48-EconomyIcons/gemIcon.svg" class="icon-small" alt="Gems">
                            ${cost.gems}
                        </span>
                    `);
                }
                
                // Heart requirement with custom icon
                if (cost.minHearts > 0) {
                    const hasEnough = playerResources.hearts >= cost.minHearts;
                    costItems.push(`
                        <span class="cost-item hearts ${!hasEnough ? 'insufficient' : ''}">
                            <img src="./48x48-EconomyIcons/heartIcon.svg" class="icon-small" alt="Hearts">
                            >${cost.minHearts}
                        </span>
                    `);
                }
                
                // Coins cost with custom icon
                if (cost.coins > 0) {
                    const hasEnough = playerResources.coins >= cost.coins;
                    costItems.push(`
                        <span class="cost-item coins ${!hasEnough ? 'insufficient' : ''}">
                            <img src="./48x48-EconomyIcons/coinIcon.svg" class="icon-small" alt="Coins">
                            ${cost.coins}
                        </span>
                    `);
                }
                
                // Tickets cost with custom icon
                if (cost.tickets > 0) {
                    const hasEnough = playerResources.tickets >= cost.tickets;
                    costItems.push(`
                        <span class="cost-item tickets ${!hasEnough ? 'insufficient' : ''}">
                            <img src="./48x48-EconomyIcons/ticketIcon.svg" class="icon-small" alt="Tickets">
                            ${cost.tickets}
                        </span>
                    `);
                }
                
                // Keys cost with custom icon
                if (cost.keys > 0) {
                    const hasEnough = playerResources.keys >= cost.keys;
                    costItems.push(`
                        <span class="cost-item keys ${!hasEnough ? 'insufficient' : ''}">
                            <img src="./48x48-EconomyIcons/keyIcon.svg" class="icon-small" alt="Keys">
                            ${cost.keys}
                        </span>
                    `);
                }
                
                return `
                    <div class="card-cost-bar">
                        <div class="cost-display">
                            <span class="cost-label">Cost:</span>
                            <div class="cost-items">
                                ${costItems.join('')}
                            </div>
                        </div>
                        <div class="cost-details">
                            ${this.buildCostDetails(playerResources)}
                        </div>
                    </div>
                `;
            }
            
            buildRewardsFooter() {
                const rewards = this.economics.rewards;
                const rewardItems = [];
                
                // XP with custom icon
                if (rewards.xp) {
                    const xpText = rewards.xp.min === rewards.xp.max ? 
                        `${rewards.xp.max}` : 
                        `${rewards.xp.min}-${rewards.xp.max}`;
                    rewardItems.push(`
                        <span class="reward-item xp" title="${xpText} Experience Points">
                            <img src="./48x48-EconomyIcons/xpIcon.svg" class="icon-small" alt="XP">
                            <span class="reward-value">${xpText}</span>
                        </span>
                    `);
                }
                
                // Gems with custom icon - always use icon(count) format
                if (rewards.gems) {
                    const gemText = rewards.gems.min === rewards.gems.max ? 
                        `(${rewards.gems.max})` : 
                        `(${rewards.gems.min}-${rewards.gems.max})`;
                    rewardItems.push(`
                        <span class="reward-item gems" title="${rewards.gems.min}-${rewards.gems.max} Gems">
                            <img src="./48x48-EconomyIcons/gemIcon.svg" class="icon-small" alt="Gems">
                            <span class="reward-value">${gemText}</span>
                        </span>
                    `);
                }
                
                // Coins with custom icon
                if (rewards.coins) {
                    const coinText = rewards.coins.min === rewards.coins.max ? 
                        `${rewards.coins.max}` : 
                        `${rewards.coins.min}-${rewards.coins.max}`;
                    rewardItems.push(`
                        <span class="reward-item coins" title="${coinText} Coins">
                            <img src="./48x48-EconomyIcons/coinIcon.svg" class="icon-small" alt="Coins">
                            <span class="reward-value">${coinText}</span>
                        </span>
                    `);
                }
                
                // Mystery/Rare with custom gift box icon
                if (rewards.rare) {
                    rewardItems.push(`
                        <span class="reward-item rare" title="${rewards.rare}">
                            <img src="./48x48-EconomyIcons/giftBox.svg" class="icon-small" alt="Mystery">
                            <span class="reward-value">?</span>
                        </span>
                    `);
                }
                
                return `
                    <div class="card-rewards-footer">
                        <span class="rewards-label">Win:</span>
                        <div class="reward-items">
                            ${rewardItems.join('')}
                        </div>
                    </div>
                `;
            }
            
            // Copy all other methods from GenericCardEnhanced...
            buildCostDetails(playerResources) {
                const cost = this.economics.cost;
                const eventModifiers = this.getEventModifiers();
                
                const details = [];
                
                if (cost.energy > 0) {
                    const modifiedCost = this.applyEventModifiers(cost.energy, eventModifiers);
                    const hasEnough = playerResources.energy >= modifiedCost;
                    details.push(`
                        <div class="cost-detail-row ${!hasEnough ? 'insufficient' : ''}">
                            <span>Energy Required:</span>
                            <span>${modifiedCost} / ${playerResources.energy}</span>
                        </div>
                    `);
                    
                    if (!hasEnough) {
                        const timeToRegen = Math.ceil((modifiedCost - playerResources.energy) * 5);
                        details.push(`
                            <div class="cost-detail-row insufficient">
                                <span>Time to regenerate:</span>
                                <span>${timeToRegen} min</span>
                            </div>
                        `);
                    }
                }
                
                if (eventModifiers.length > 0) {
                    details.push(`
                        <div class="cost-detail-row" style="color: #4ecca3;">
                            <span>Active Events:</span>
                            <span>${eventModifiers.map(e => e.name).join(', ')}</span>
                        </div>
                    `);
                }
                
                return details.join('');
            }
            
            buildEventBadges() {
                const badges = this.events.map(event => {
                    const badgeClass = this.getEventBadgeClass(event.type);
                    return `
                        <div class="event-badge ${badgeClass}">
                            ${event.label}
                        </div>
                    `;
                });
                
                return `
                    <div class="card-event-badges">
                        ${badges.join('')}
                    </div>
                `;
            }
            
            buildEnhancedActions(content) {
                const { primary, secondary, link } = content;
                const canAfford = this.checkAffordability();
                const buttonClass = this.getButtonClass();
                const encouragement = this.getRandomEncouragement();
                
                return `
                    <div class="card-section section-actions">
                        ${secondary ? `<button class="action-button action-secondary" data-action="${secondary.action}">
                            ${secondary.text}
                        </button>` : ''}
                        ${primary ? `
                            <button class="action-button action-primary ${buttonClass}" 
                                    data-action="${primary.action}"
                                    ${!canAfford ? 'disabled' : ''}
                                    onmouseover="this.querySelector('.encouragement-popup')?.classList.add('show')"
                                    onmouseout="this.querySelector('.encouragement-popup')?.classList.remove('show')">
                                ${primary.icon || ''} ${this.getButtonText(primary.text)}
                                <div class="encouragement-popup">${encouragement}</div>
                            </button>
                        ` : ''}
                        ${link ? `<a href="#" class="card-link" data-action="${link.action}">
                            ${link.text}
                        </a>` : ''}
                    </div>
                `;
            }
            
            // Include all helper methods
            checkAffordability() {
                if (!this.economics?.cost || !this.economyManager) return true;
                return this.economyManager.canAfford(this.economics.cost);
            }
            
            getPlayerResources() {
                if (this.economyManager) {
                    return this.economyManager.getResources();
                }
                return {
                    energy: 100,
                    hearts: 5,
                    gems: 0,
                    coins: 0,
                    tickets: 0,
                    keys: 0
                };
            }
            
            getEventModifiers() {
                return this.events.filter(e => e.costModifier);
            }
            
            applyEventModifiers(baseCost, modifiers) {
                let cost = baseCost;
                modifiers.forEach(mod => {
                    if (mod.costModifier?.type === 'percentage') {
                        cost = Math.floor(cost * (1 - mod.costModifier.value));
                    } else if (mod.costModifier?.type === 'flat') {
                        cost = Math.max(0, cost - mod.costModifier.value);
                    }
                });
                return cost;
            }
            
            getEventBadgeClass(eventType) {
                const classMap = {
                    'power-hour': 'power-hour',
                    'learning-party': 'learning-party',
                    'perfect-streak': 'perfect-streak',
                    'quest': 'quest-active',
                    'limited': 'limited-time'
                };
                return classMap[eventType] || '';
            }
            
            getButtonClass() {
                const canAfford = this.checkAffordability();
                if (!canAfford) return 'cta-locked';
                
                const hasFreeevent = this.events.some(e => e.type === 'free');
                if (hasFreeevent) return 'cta-free';
                
                const hasBoost = this.events.some(e => e.type === 'boost');
                if (hasBoost) return 'cta-boost';
                
                return '';
            }
            
            getButtonText(defaultText) {
                const canAfford = this.checkAffordability();
                if (!canAfford) return 'LOCKED';
                
                const hasFreeevent = this.events.some(e => e.type === 'free');
                if (hasFreeevent) return 'PLAY FREE';
                
                const hasBoost = this.events.some(e => e.type === 'boost');
                if (hasBoost) return 'PLAY WITH BOOST';
                
                return defaultText || 'PLAY NOW';
            }
            
            getRandomEncouragement() {
                const encouragements = [
                    "Brilliant!",
                    "Well played!",
                    "You've got this!",
                    "Perfect timing!",
                    "Nailed it!",
                    "Excellent choice!",
                    "Let's go!",
                    "Amazing!"
                ];
                return encouragements[Math.floor(Math.random() * encouragements.length)];
            }
            
            buildSection(type, content) {
                const builders = {
                    header: this.buildHeader.bind(this),
                    media: this.buildMedia.bind(this),
                    body: this.buildBody.bind(this),
                    stats: this.buildStats.bind(this),
                    actions: this.buildActions.bind(this)
                };
                return builders[type] ? builders[type](content) : '';
            }
            
            buildHeader(content) {
                const { icon, title, badges, meta } = content;
                return `
                    <div class="card-section card-header">
                        ${icon ? `<div class="card-icon">${this.renderIcon(icon)}</div>` : ''}
                        ${title ? `<div class="card-title-area">
                            <h3 class="card-title">${title}</h3>
                            ${meta ? `<p class="card-meta">${meta}</p>` : ''}
                        </div>` : ''}
                        ${badges ? `<div class="card-badges">${this.renderBadges(badges)}</div>` : ''}
                    </div>
                `;
            }
            
            buildBody(content) {
                const { title, description, highlights, progress, list, badges } = content;
                
                const filteredBadges = badges ? badges.filter(badge => 
                    !['chaos-mode', 'zen-mode', 'speed-mode'].includes(badge.type)
                ) : null;
                
                return `
                    <div class="card-section card-body">
                        ${title ? `<h4 class="body-title">${title}</h4>` : ''}
                        ${description ? `<p class="body-description">${description}</p>` : ''}
                        ${filteredBadges && filteredBadges.length > 0 ? `<div class="body-badges">${this.renderBadges(filteredBadges)}</div>` : ''}
                        ${highlights ? `<div class="body-highlights">
                            ${highlights.map(h => `<span class="highlight highlight-${h.type}">H${h.text}</span>`).join('')}
                        </div>` : ''}
                        ${list ? `<ul class="body-list">
                            ${list.map(item => `<li class="${item.done ? 'done' : ''}">${item.text}</li>`).join('')}
                        </ul>` : ''}
                        ${progress ? this.renderProgress(progress) : ''}
                    </div>
                `;
            }
            
            buildMedia(content) {
                const { type, src, alt, thumbnail } = content;
                switch(type) {
                    case 'image':
                        return `<div class="card-section card-media">
                            <img src="${src}" alt="${alt || ''}" class="card-image">
                        </div>`;
                    case 'video':
                        return `<div class="card-section card-media">
                            <video src="${src}" poster="${thumbnail || ''}" class="card-video"></video>
                            <div class="play-overlay">▶</div>
                        </div>`;
                    case 'icon-grid':
                        return `<div class="card-section card-media card-icon-grid">
                            ${src.map(icon => `<span class="grid-icon">${icon}</span>`).join('')}
                        </div>`;
                    default:
                        return '';
                }
            }
            
            buildStats(content) {
                return `
                    <div class="card-section card-stats">
                        ${content.map(stat => `
                            <div class="stat-item">
                                ${stat.icon ? `<span class="stat-icon">${stat.icon}</span>` : ''}
                                ${stat.label ? `<span class="stat-label">${stat.label}</span>` : ''}
                                <span class="stat-value">${stat.value}</span>
                            </div>
                        `).join('')}
                    </div>
                `;
            }
            
            buildActions(content) {
                return this.buildEnhancedActions(content);
            }
            
            renderIcon(icon) {
                if (typeof icon === 'string') {
                    return icon;
                } else if (icon.type === 'svg') {
                    return icon.content;
                } else if (icon.type === 'image') {
                    return `<img src="${icon.src}" alt="${icon.alt || ''}" class="icon-image">`;
                }
                return '';
            }
            
            renderBadges(badges) {
                return badges.map(badge => {
                    const classes = ['badge'];
                    if (badge.type) classes.push(`badge-${badge.type}`);
                    if (badge.animated) classes.push('badge-animated');
                    
                    return `<span class="${classes.join(' ')}" ${badge.tooltip ? `title="${badge.tooltip}"` : ''}>
                        ${badge.icon || ''} ${badge.text}
                    </span>`;
                }).join('');
            }
            
            renderProgress(progress) {
                const { type, value, max, text } = progress;
                const percentage = max ? (value / max) * 100 : value;
                
                if (type === 'bar') {
                    return `
                        <div class="progress-container">
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: ${percentage}%"></div>
                            </div>
                            ${text ? `<span class="progress-text">${text}</span>` : ''}
                        </div>
                    `;
                } else if (type === 'circular') {
                    return `
                        <div class="progress-circular" data-progress="${percentage}">
                            <span class="progress-value">${Math.round(percentage)}%</span>
                        </div>
                    `;
                }
                return '';
            }
            
            attachEventHandlers() {
                this.element.addEventListener('click', (e) => {
                    if (e.target.closest('.action-button') || e.target.closest('.card-link') || e.target.closest('.cost-expand-btn')) {
                        return;
                    }
                    this.handleAction('card-click');
                });
                
                this.element.querySelectorAll('[data-action]').forEach(button => {
                    button.addEventListener('click', (e) => {
                        e.preventDefault();
                        e.stopPropagation();
                        
                        if (button.disabled) {
                            this.showInsufficientResourcesMessage();
                            return;
                        }
                        
                        this.handleAction(button.dataset.action);
                    });
                });
            }
            
            showInsufficientResourcesMessage() {
                if (window.showToast) {
                    window.showToast('Not enough resources!', 'error');
                } else {
                    console.log('Insufficient resources for this action');
                }
            }
            
            handleAction(action) {
                this.onAction(action, {
                    cardId: this.id,
                    component: this.component,
                    config: this.componentConfig,
                    data: this.data
                });
            }
        }
    </script>
    
    <script>
        function createTestCards() {
            const container = document.getElementById('cardsContainer');
            container.innerHTML = '';
            
            // Test Card 1: Standard Quiz (Multiple costs)
            const card1 = new GenericCardEnhancedCustom({
                id: 'test-quiz-1',
                type: 'quiz',
                theme: 'standard',
                events: [...activeEvents],
                economics: {
                    cost: {
                        energy: 10,
                        coins: 5,
                        minHearts: 0
                    },
                    rewards: {
                        xp: { min: 10, max: 100 },
                        gems: { min: 0, max: 3 },
                        coins: { min: 5, max: 20 }
                    }
                },
                data: {
                    header: {
                        icon: '<img src="./kawaii-quiz-app/src/images/categories/science.svg" alt="Science" style="width: 100%; height: 100%; object-fit: contain;">',
                        title: 'Brain Teaser Challenge'
                    },
                    body: {
                        description: 'Test your knowledge with today\'s featured quiz! Explore the wonders of science through challenging questions.',
                        badges: [
                            { text: 'Medium', type: 'difficulty' }
                        ]
                    },
                    actions: {
                        primary: { text: 'Play Now!', action: 'test-action' }
                    }
                },
                onAction: (action) => console.log('Action:', action)
            });
            
            // Test Card 2: Chaos Mode (Gems required)
            const card2 = new GenericCardEnhancedCustom({
                id: 'test-quiz-2',
                type: 'quiz',
                theme: 'chaos',
                events: activeEvents.filter(e => e.type === 'learning-party'),
                economics: {
                    cost: {
                        energy: 50,
                        gems: 2,
                        minHearts: 0
                    },
                    rewards: {
                        xp: { min: 50, max: 200 },
                        gems: { min: 2, max: 5 },
                        rare: 'Mystery Box (5% chance)'
                    }
                },
                data: {
                    header: {
                        icon: '<img src="./kawaii-quiz-app/src/images/categories/mythology.svg" alt="Mythology" style="width: 100%; height: 100%; object-fit: contain;">',
                        title: 'Chaos Mode Challenge'
                    },
                    body: {
                        description: 'Can you handle the unpredictable chaos? Rules change every question!',
                        badges: [
                            { text: 'Expert', type: 'difficulty' }
                        ]
                    },
                    actions: {
                        primary: { text: 'Embrace Chaos', action: 'test-action' }
                    }
                },
                onAction: (action) => console.log('Action:', action)
            });
            
            // Test Card 3: Zen Mode (Keys required)
            const card3 = new GenericCardEnhancedCustom({
                id: 'test-quiz-3',
                type: 'quiz',
                theme: 'zen',
                events: [],
                economics: {
                    cost: {
                        energy: 20,
                        keys: 1,
                        minHearts: 3
                    },
                    rewards: {
                        xp: { min: 100, max: 500 },
                        gems: { min: 5, max: 10 }
                    }
                },
                data: {
                    header: {
                        icon: '<img src="./kawaii-quiz-app/src/images/categories/nature.svg" alt="Nature" style="width: 100%; height: 100%; object-fit: contain;">',
                        title: 'Zen Master Challenge'
                    },
                    body: {
                        description: 'Find inner peace while solving mindful puzzles. No time pressure, just pure knowledge.',
                        badges: [
                            { text: 'Hard', type: 'difficulty' }
                        ]
                    },
                    actions: {
                        primary: { text: 'Find Peace', action: 'test-action' }
                    }
                },
                onAction: (action) => console.log('Action:', action)
            });
            
            // Test Card 4: Practice Card (Minimal cost)
            const card4 = new GenericCardEnhancedCustom({
                id: 'test-practice-1',
                type: 'practice',
                theme: 'practice',
                events: [{
                    type: 'limited',
                    label: 'FIRST PRACTICE',
                    name: 'Daily First Practice Bonus'
                }],
                economics: {
                    cost: {
                        energy: 1,
                        minHearts: 0
                    },
                    rewards: {
                        xp: { min: 10, max: 50 },
                        coins: { min: 1, max: 5 }
                    }
                },
                data: {
                    header: {
                        icon: '😄',
                        title: 'Bad Pun Practice'
                    },
                    body: {
                        description: 'Groan-worthy wordplay to test your pun tolerance! Can you survive the eye-rolls?',
                        badges: [
                            { text: '15 cards', type: 'info' },
                            { text: '5 min', type: 'timer' }
                        ]
                    },
                    actions: {
                        primary: { text: 'Start Practice', action: 'test-action' }
                    }
                },
                onAction: (action) => console.log('Action:', action)
            });
            
            // Test Card 5: Speed Mode (Tickets required)
            const card5 = new GenericCardEnhancedCustom({
                id: 'test-quiz-5',
                type: 'quiz',
                theme: 'speed',
                events: [...activeEvents],
                economics: {
                    cost: {
                        energy: 15,
                        tickets: 1,
                        minHearts: 2
                    },
                    rewards: {
                        xp: { min: 30, max: 150 },
                        gems: { min: 1, max: 4 },
                        rare: 'Speed Trophy (10% chance)'
                    }
                },
                data: {
                    header: {
                        icon: '<img src="./kawaii-quiz-app/src/images/categories/technology.svg" alt="Technology" style="width: 100%; height: 100%; object-fit: contain;">',
                        title: 'Speed Run Challenge'
                    },
                    body: {
                        description: 'Race against time! Quick answers earn bonus points. Are you fast enough?',
                        badges: [
                            { text: 'Medium', type: 'difficulty' }
                        ]
                    },
                    actions: {
                        primary: { text: 'Go Fast!', action: 'test-action' }
                    }
                },
                onAction: (action) => console.log('Action:', action)
            });
            
            // Render all cards
            container.appendChild(card1.render());
            container.appendChild(card2.render());
            container.appendChild(card3.render());
            container.appendChild(card4.render());
            container.appendChild(card5.render());
        }
        
        function refreshCards() {
            createTestCards();
        }
        
        // Initial setup
        updateResourceDisplay();
        createTestCards();
    </script>
</body>
</html>