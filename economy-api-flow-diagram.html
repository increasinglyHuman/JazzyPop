<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JazzyPop Economy API Flow</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: #0a0e27;
            color: #eee;
            margin: 0;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        h1, h2 {
            color: #00d2d3;
        }
        
        .flow-container {
            background: #1a1a2e;
            border-radius: 12px;
            padding: 30px;
            margin: 20px 0;
            position: relative;
            overflow: hidden;
        }
        
        /* API endpoint boxes */
        .api-endpoint {
            background: #16213e;
            border: 2px solid #00d2d3;
            border-radius: 8px;
            padding: 15px;
            margin: 10px;
            position: relative;
        }
        
        .api-endpoint.post {
            border-color: #e94560;
        }
        
        .api-endpoint.get {
            border-color: #4ecca3;
        }
        
        .method-badge {
            position: absolute;
            top: -10px;
            left: 20px;
            background: #0a0e27;
            padding: 2px 10px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
        }
        
        .method-badge.post {
            color: #e94560;
        }
        
        .method-badge.get {
            color: #4ecca3;
        }
        
        /* Flow arrows */
        .flow-section {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin: 40px 0;
            position: relative;
        }
        
        .flow-arrow {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 32px;
            color: #f39c12;
            z-index: 1;
        }
        
        .component-box {
            background: #2d4356;
            border: 2px solid #f39c12;
            border-radius: 12px;
            padding: 20px;
            flex: 1;
            margin: 0 60px;
            text-align: center;
        }
        
        /* Sequence diagram */
        .sequence-diagram {
            background: #0f3460;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }
        
        .sequence-step {
            display: flex;
            align-items: center;
            margin: 15px 0;
            position: relative;
        }
        
        .step-number {
            background: #e94560;
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-right: 15px;
        }
        
        .step-content {
            flex: 1;
            background: #16213e;
            padding: 12px;
            border-radius: 6px;
        }
        
        /* API details */
        .api-details {
            background: #0a0e27;
            border-radius: 6px;
            padding: 15px;
            margin-top: 10px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
        }
        
        .param {
            color: #00d2d3;
        }
        
        .response {
            color: #4ecca3;
        }
        
        /* State diagram */
        .state-box {
            background: #3d2352;
            border: 2px solid #ff6b6b;
            border-radius: 8px;
            padding: 15px;
            margin: 10px;
            text-align: center;
        }
        
        .state-flow {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin: 30px 0;
        }
        
        /* Legend */
        .legend {
            display: flex;
            gap: 30px;
            margin: 20px 0;
            justify-content: center;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .legend-box {
            width: 20px;
            height: 20px;
            border: 2px solid;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>🔄 JazzyPop Economy API Flow Architecture</h1>
        
        <!-- Main Flow -->
        <div class="flow-container">
            <h2>Frontend ↔ Backend Economy Flow</h2>
            
            <div class="flow-section">
                <div class="component-box">
                    <h3>Frontend Components</h3>
                    <p>• EconomyManager.js</p>
                    <p>• CardManager.js</p>
                    <p>• QuizModal.js</p>
                    <p>• FlashcardModal.js</p>
                </div>
                
                <span class="flow-arrow">⟷</span>
                
                <div class="component-box">
                    <h3>Backend APIs</h3>
                    <p>• /api/economy/*</p>
                    <p>• /api/cards/*</p>
                    <p>• /api/content/*</p>
                    <p>• /api/users/*</p>
                </div>
            </div>
        </div>
        
        <!-- API Endpoints -->
        <div class="flow-container">
            <h2>Economy API Endpoints</h2>
            
            <div class="api-endpoint get">
                <span class="method-badge get">GET</span>
                <h3>/api/economy/state</h3>
                <p>Get current player economy state</p>
                <div class="api-details">
                    <p><span class="param">Params:</span> session_id, user_id</p>
                    <p><span class="response">Returns:</span> { energy, hearts, gems, xp, level, streak }</p>
                </div>
            </div>
            
            <div class="api-endpoint post">
                <span class="method-badge post">POST</span>
                <h3>/api/economy/process-result</h3>
                <p>Process game result and calculate rewards</p>
                <div class="api-details">
                    <p><span class="param">Body:</span> { type, category, difficulty, mode, correct_answers, total_questions, time_spent, streak }</p>
                    <p><span class="response">Returns:</span> { new_state, rewards, level_up, bonuses_applied }</p>
                </div>
            </div>
            
            <div class="api-endpoint post">
                <span class="method-badge post">POST</span>
                <h3>/api/economy/spend</h3>
                <p>Spend resources (energy, hearts, etc)</p>
                <div class="api-details">
                    <p><span class="param">Body:</span> { resource, amount, reason }</p>
                    <p><span class="response">Returns:</span> { success, new_value, insufficient_funds }</p>
                </div>
            </div>
            
            <div class="api-endpoint get">
                <span class="method-badge get">GET</span>
                <h3>/api/economy/bonuses</h3>
                <p>Get active bonuses and events</p>
                <div class="api-details">
                    <p><span class="param">Params:</span> session_id</p>
                    <p><span class="response">Returns:</span> { personal_bonuses, global_events, category_buffs }</p>
                </div>
            </div>
        </div>
        
        <!-- Sequence Diagram -->
        <div class="flow-container">
            <h2>Quiz Completion Sequence</h2>
            
            <div class="sequence-diagram">
                <div class="sequence-step">
                    <div class="step-number">1</div>
                    <div class="step-content">
                        <strong>User clicks "Play Now" on card</strong>
                        <p>CardManager checks affordability via EconomyManager.checkAffordability()</p>
                    </div>
                </div>
                
                <div class="sequence-step">
                    <div class="step-number">2</div>
                    <div class="step-content">
                        <strong>POST /api/economy/spend</strong>
                        <p>Deduct energy cost (optimistic update + server validation)</p>
                    </div>
                </div>
                
                <div class="sequence-step">
                    <div class="step-number">3</div>
                    <div class="step-content">
                        <strong>User completes quiz</strong>
                        <p>QuizModal collects results: score, time, streak</p>
                    </div>
                </div>
                
                <div class="sequence-step">
                    <div class="step-number">4</div>
                    <div class="step-content">
                        <strong>POST /api/economy/process-result</strong>
                        <p>Server calculates rewards based on performance + active bonuses</p>
                    </div>
                </div>
                
                <div class="sequence-step">
                    <div class="step-number">5</div>
                    <div class="step-content">
                        <strong>Display rewards popup</strong>
                        <p>Show earned XP, gems, bonuses with animations</p>
                    </div>
                </div>
                
                <div class="sequence-step">
                    <div class="step-number">6</div>
                    <div class="step-content">
                        <strong>Update UI state</strong>
                        <p>Refresh resource displays, check for level up</p>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- State Management -->
        <div class="flow-container">
            <h2>Economy State Management</h2>
            
            <div class="state-flow">
                <div class="state-box">
                    <h3>Local Cache</h3>
                    <p>• Immediate UI updates</p>
                    <p>• Optimistic rendering</p>
                    <p>• Offline support</p>
                </div>
                
                <div class="state-box">
                    <h3>Server State</h3>
                    <p>• Source of truth</p>
                    <p>• Validation</p>
                    <p>• Anti-cheat</p>
                </div>
                
                <div class="state-box">
                    <h3>Sync Strategy</h3>
                    <p>• Every 30 seconds</p>
                    <p>• On page focus</p>
                    <p>• After transactions</p>
                </div>
            </div>
        </div>
        
        <!-- Data Flow for Cards -->
        <div class="flow-container">
            <h2>Card Economy Data Flow</h2>
            
            <pre style="background: #0a0e27; padding: 20px; border-radius: 8px; overflow-x: auto;">
// 1. Card receives economics data from CardManager
const cardConfig = {
    economics: {
        cost: { energy: 10, minHearts: 3 },
        rewards: {
            range: {
                xp: "20-50",
                gems: "2-5"
            }
        }
    }
};

// 2. Card displays cost/rewards via GenericCard.buildEconomicsDisplay()
&lt;div class="card-economics"&gt;
    &lt;div class="card-cost"&gt;⚡ 10 | ❤️ >2&lt;/div&gt;
    &lt;div class="card-rewards"&gt;XP: 20-50 | 💎 2-5&lt;/div&gt;
&lt;/div&gt;

// 3. On click, validate with EconomyManager
const canPlay = economyManager.checkAffordability({
    energy: 10,
    minHearts: 3
});

// 4. Process result after game
const result = await economyManager.processQuizComplete({
    category: 'science',
    difficulty: 'medium',
    correctAnswers: 8,
    totalQuestions: 10,
    timeSpent: 45,
    streak: 3
});
            </pre>
        </div>
        
        <!-- Bonus System -->
        <div class="flow-container">
            <h2>Dynamic Bonus System</h2>
            
            <div class="legend">
                <div class="legend-item">
                    <div class="legend-box" style="border-color: #4ecca3;"></div>
                    <span>Personal Bonuses</span>
                </div>
                <div class="legend-item">
                    <div class="legend-box" style="border-color: #f39c12;"></div>
                    <span>Global Events</span>
                </div>
                <div class="legend-item">
                    <div class="legend-box" style="border-color: #e94560;"></div>
                    <span>Category Buffs</span>
                </div>
            </div>
            
            <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin-top: 20px;">
                <div class="api-endpoint" style="border-color: #4ecca3;">
                    <h4>Personal Power-ups</h4>
                    <ul style="text-align: left; margin: 10px 0;">
                        <li>XP Boost (2x for 10 min)</li>
                        <li>Coin Magnet (2x coins)</li>
                        <li>Gem Finder (+50% gems)</li>
                        <li>Lucky Charm (bonus rolls)</li>
                    </ul>
                </div>
                
                <div class="api-endpoint" style="border-color: #f39c12;">
                    <h4>Time-based Events</h4>
                    <ul style="text-align: left; margin: 10px 0;">
                        <li>2x Tuesday (all XP/coins)</li>
                        <li>Gem Friday (2x gems)</li>
                        <li>Happy Hour (3-5pm)</li>
                        <li>Early Bird (6-9am)</li>
                    </ul>
                </div>
                
                <div class="api-endpoint" style="border-color: #e94560;">
                    <h4>Category Buffs</h4>
                    <ul style="text-align: left; margin: 10px 0;">
                        <li>Science Monday (+50%)</li>
                        <li>History Tuesday (+50%)</li>
                        <li>Arts Thursday (+50%)</li>
                        <li>Architecture Week (2x)</li>
                    </ul>
                </div>
            </div>
        </div>
        
        <!-- Implementation Notes -->
        <div class="flow-container">
            <h2>Implementation Strategy</h2>
            
            <ol style="line-height: 2; font-size: 16px;">
                <li><strong>Phase 1:</strong> Enhance card display to show all economy info (costs, rewards, modifiers)</li>
                <li><strong>Phase 2:</strong> Connect cards to live economy data from EconomyManager</li>
                <li><strong>Phase 3:</strong> Implement reward popup system with animations</li>
                <li><strong>Phase 4:</strong> Add visual indicators for active bonuses/events</li>
                <li><strong>Phase 5:</strong> Create quest progress tracking on cards</li>
                <li><strong>Phase 6:</strong> Add hover states for detailed reward breakdowns</li>
            </ol>
        </div>
    </div>
</body>
</html>